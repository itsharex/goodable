# é£ä¹¦çŸ¥è¯†åº“æ–‡æ¡£æŸ¥çœ‹å™¨

ä¸€ä¸ªåŸºäº FastAPI çš„é£ä¹¦çŸ¥è¯†åº“æ–‡æ¡£æŸ¥çœ‹å’Œå±•ç¤ºåº”ç”¨ï¼Œæ”¯æŒæµè§ˆçŸ¥è¯†åº“åˆ—è¡¨ã€æ–‡æ¡£å†…å®¹ï¼Œå¹¶èƒ½æŸ¥çœ‹æ–‡æ¡£ä¸­çš„å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šåª’ä½“æ–‡ä»¶ã€‚


## æ›´æ–°è®°å½•
20251219 ç«¯å£è‡ªåŠ¨è¯†åˆ«
 - ä¼˜åŒ–æˆæƒæµç¨‹ï¼Œè‡ªåŠ¨ä»è¯·æ±‚ä¸­è·å–å®é™…è¿è¡Œç«¯å£ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½® PORT ç¯å¢ƒå˜é‡

20251218 ä¸¤æ¬¡æ›´æ–°
 - å¢é‡è®¾ç½®é¡µé¢é…ç½®è·å–tokenåŠŸèƒ½
 - é‡æ„ä¸ºgoodableéœ€è¦çš„pythonæ¨¡æ¿æ ¼å¼

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“š æµè§ˆæ‰€æœ‰é£ä¹¦çŸ¥è¯†åº“åˆ—è¡¨
- ğŸ“„ æŸ¥çœ‹çŸ¥è¯†åº“æ–‡æ¡£å†…å®¹ï¼ˆå¯Œæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰ï¼‰
- ğŸ¨ ç¾è§‚çš„ Web ç•Œé¢å±•ç¤º
- ğŸ“¥ æ”¯æŒæ–‡ä»¶ä¸‹è½½åŠŸèƒ½
- âš™ï¸ ä¾¿æ·çš„é…ç½®ç®¡ç†å’Œæˆæƒæµç¨‹

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.11+
- é£ä¹¦å¼€æ”¾å¹³å°è´¦å·

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–åŒ…ï¼š
- FastAPI - ç°ä»£åŒ–çš„ Web æ¡†æ¶
- Uvicorn - ASGI æœåŠ¡å™¨
- lark-oapi - é£ä¹¦å¼€æ”¾å¹³å° SDK
- requests - HTTP è¯·æ±‚åº“
- python-dotenv - ç¯å¢ƒå˜é‡ç®¡ç†

### 3. é…ç½®é£ä¹¦åº”ç”¨

#### 3.1 åˆ›å»ºé£ä¹¦åº”ç”¨

1. è®¿é—® [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
3. è·å– `App ID` å’Œ `App Secret`

#### 3.2 é…ç½®åº”ç”¨æƒé™

åœ¨é£ä¹¦å¼€æ”¾å¹³å°åº”ç”¨ç®¡ç†ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹æƒé™ï¼š

- `auth:user.id:read` - è¯»å–ç”¨æˆ·ä¿¡æ¯
- `docs:document.media:download` - ä¸‹è½½æ–‡æ¡£åª’ä½“
- `docs:document.media:upload` - ä¸Šä¼ æ–‡æ¡£åª’ä½“
- `docx:document` - è®¿é—®æ–‡æ¡£
- `wiki:wiki` - è®¿é—®çŸ¥è¯†åº“
- `offline_access` - ç¦»çº¿è®¿é—®

#### 3.3 é…ç½®é‡å®šå‘ URL

åœ¨é£ä¹¦å¼€æ”¾å¹³å°åº”ç”¨çš„**å®‰å…¨è®¾ç½®**ä¸­æ·»åŠ é‡å®šå‘ URLã€‚

**âœ¨ æ™ºèƒ½ç«¯å£è¯†åˆ«**ï¼š
åº”ç”¨ä¼šè‡ªåŠ¨è¯†åˆ«å®é™…è¿è¡Œçš„ç«¯å£ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½® PORT ç¯å¢ƒå˜é‡ã€‚

**æ¨èé…ç½®ï¼ˆå»ºè®®åŒæ—¶æ·»åŠ å¤šä¸ªç«¯å£ï¼‰**ï¼š

```
http://localhost:5000/api/config/callback
http://localhost:3100/api/config/callback
http://localhost:3101/api/config/callback
http://localhost:3102/api/config/callback
```

**é…ç½®è¯´æ˜**ï¼š
- **æœ¬åœ°å¼€å‘**ï¼šé€šå¸¸ä½¿ç”¨ `5000` æˆ– `8000` ç«¯å£
- **Goodable å¹³å°**ï¼šä¼šåœ¨ `3100-3999` èŒƒå›´å†…åŠ¨æ€åˆ†é…ç«¯å£
- **è‡ªå®šä¹‰ç«¯å£**ï¼šæ ¹æ®å®é™…è¿è¡Œç«¯å£æ·»åŠ å¯¹åº”çš„å›è°ƒ URL

**å·¥ä½œåŸç†**ï¼š
- åº”ç”¨åœ¨ç”Ÿæˆæˆæƒ URL æ—¶ï¼Œä¼šè‡ªåŠ¨ä» HTTP è¯·æ±‚ä¸­è·å–å½“å‰æœåŠ¡çš„å®é™…ç«¯å£
- æ— éœ€åœ¨ `.env` æ–‡ä»¶ä¸­æ‰‹åŠ¨è®¾ç½® `PORT` å˜é‡
- é€‚é…ä»»ä½•éƒ¨ç½²ç¯å¢ƒï¼ŒåŒ…æ‹¬ Dockerã€äº‘å¹³å°ç­‰

### 4. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` æ–‡ä»¶ä¸º `.env`ï¼š

```bash
cp .env.example .env
```

æˆ–è€…å¯åŠ¨åº”ç”¨ååœ¨è®¾ç½®é¡µé¢ä¸­å¡«å†™é…ç½®ã€‚

### 5. è¿è¡Œåº”ç”¨

```bash
uvicorn app.main:app --host 0.0.0.0 --port 5000 --reload
```

åº”ç”¨å°†åœ¨ `http://localhost:5000` å¯åŠ¨ã€‚

**ç«¯å£è¯´æ˜**ï¼š
- âœ… **è‡ªåŠ¨ç«¯å£è¯†åˆ«**ï¼šåº”ç”¨ä¼šè‡ªåŠ¨ä»è¯·æ±‚ä¸­è·å–å®é™…è¿è¡Œç«¯å£ï¼Œæ— éœ€é…ç½®
- æœ¬åœ°å¼€å‘é»˜è®¤ï¼š5000
- Goodable å¹³å°ï¼š3100-3999ï¼ˆå¹³å°è‡ªåŠ¨åˆ†é…ï¼‰
- è‡ªå®šä¹‰ç«¯å£ï¼šé€šè¿‡å‘½ä»¤è¡Œå‚æ•° `--port` æŒ‡å®š

### 6. é…ç½®å’Œæˆæƒ

1. è®¿é—® `http://localhost:5000`
2. ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„"è®¾ç½®"
3. å¡«å†™ App ID å’Œ App Secret
4. ç‚¹å‡»"ä¿å­˜é…ç½®"
5. ç‚¹å‡»"å¼€å§‹æˆæƒ"å®Œæˆç”¨æˆ·æˆæƒ
6. æˆæƒæˆåŠŸåè¿”å›é¦–é¡µå³å¯æŸ¥çœ‹çŸ¥è¯†åº“

> **æ³¨æ„**ï¼šUser Access Token æœ‰æ•ˆæœŸçº¦ 2 å°æ—¶ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°æˆæƒã€‚

## é¡¹ç›®ç»“æ„

```
project/
â”œâ”€â”€ app/                    # åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ __init__.py        # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ main.py            # FastAPI ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ api.py             # API è·¯ç”±
â”‚   â””â”€â”€ feishu_api.py      # é£ä¹¦ API å°è£…
â”œâ”€â”€ static/                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css      # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ main.js        # å‰ç«¯ JS é€»è¾‘
â”‚   â”œâ”€â”€ index.html         # çŸ¥è¯†åº“åˆ—è¡¨é¡µ
â”‚   â””â”€â”€ space.html         # æ–‡æ¡£è¯¦æƒ…é¡µ
â”œâ”€â”€ requirements.txt        # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore             # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```